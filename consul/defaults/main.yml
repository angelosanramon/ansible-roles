consul_zip_url: https://releases.hashicorp.com/consul/1.8.3/consul_1.8.3_linux_amd64.zip
consul_zip_checksum: b72e9eac5405c691c2e3b50819900ca84a79f2f6e7d73aa91f2a336fc2bcacb0
consul_user: consul
consul_group: consul
consul_bin_path: /usr/local/bin
consul_config_path: /etc/consul
consul_config_file: config.json
consul_configd_path: '{{ consul_config_path }}/consul.d'
consul_data_path: /var/lib/consul
consul_log_path: /var/log/consul
consul_log_file: consul.log
consul_run_path: /run/consul
consul_certs_path: '{{ consul_config_path }}/consul.d/tls'
consul_agent_mode: server
consul_datacenter: dc1
consul_domain: consul
consul_servers_group_name: consul_servers
consul_port: 8500

# Options for consul configuration file
consul_config_options:
  enable_local_script_checks: true
  leave_on_terminate: true
  rejoin_after_leave: true
  log_level: INFO
  log_rotate_max_files: 7
  ui: true
  dns_config:
    enable_truncate: true
    only_passing: true
  acl:
    enabled: true
    enable_token_persistence: true
    default_policy: deny
  ca_path: '{{ consul_certs_path }}'
  ca_file: '{{ consul_certs_path }}/{{ consul_domain }}-agent-ca.pem'
  cert_file: '{{ consul_certs_path }}/{{ consul_datacenter }}-server-{{ consul_domain }}-0.pem'
  key_file: '{{ consul_certs_path }}/{{ consul_datacenter }}-server-{{ consul_domain }}-0-key.pem'
  verify_incoming: true
  verify_outgoing: true
  verify_incoming_rpc: true
  verify_server_hostname: true
  auto_encrypt:
    allow_tls: true

# Options for consul command line arguments
consul_commandline_options: []
# example:
# consul_commandline_options:
#  - encrypt=WLpgAtkxNtQHR87SBS+wT5cpx83I238J5hlNuts1ZJo=

consul_env_vars: []

consul_acl_policies: []
  # example:
  # consul_acl_policies:
  #   - name: vault_policy
  #     description: Policy for Vault access
  #     rules:
  #       - resource: key_prefix
  #         segment: vault/
  #         policy: write
  #       - resource: node_prefix
  #         segment: ""
  #         policy: write
  #       - resource: service
  #         segment: vault
  #         policy: write
  #       - resource: agent_prefix
  #         segment: ""
  #         policy: write
  #       - resource: session_prefix
  #         segment: ""
  #         policy: write
  #     datacenters:
  #       - dc1
  #       - dc2
  #   - name: node_policy
  #     description: Policy for Consul agent node
  #     rules:
  #       - resource: agent_prefix
  #         segment: ""
  #         policy: write
  #       - resource: node_prefix
  #         segment: ""
  #         policy: write
  #       - resource: service_prefix
  #         segment: ""
  #         policy: read
  #       - resource: session_prefix
  #         segment: ""
  #         policy: read

consul_acl_roles: []
  # example:
  # consul_acl_roles:
  #   - name: vault_reader
  #     description: Vault reader role
  #     meta: true
  #     policy_id:
  #       - 24766e43-dec7-dfb3-3ba8-b0b71d343e54
  #       - a81019cb-822e-ae73-ed0d-3502403542d9
  #     policy_name:
  #       - node_policy
  #       - vault_policy
  #     service_identity:
  #       - consul:dc1
  #       - vault:dc2
  #     node_identity:
  #       - server1:dc1
  #       - server2:dc1
  #     format: pretty
  #     namespace: default
  #   - name: vault_writer
  #     description: Vault writer role
  #     meta: true
  #     policy_id:
  #       - 24766e43-dec7-dfb3-3ba8-b0b71d343e54
  #       - a81019cb-822e-ae73-ed0d-3502403542d9
  #     policy_name:
  #       - node_policy
  #       - vault_policy
  #     service_identity:
  #       - consul:dc1
  #       - vault:dc2
  #     node_identity:
  #       - server1:dc1
  #       - server2:dc1
  #     format: pretty
  #     namespace: default

consul_acl_tokens: []
  # example:
  # consul_acl_tokens:
  #   - accessor: 818b9ccd-7bbb-9f6e-87e2-b4039d1f584a
  #     secret: cc542a4d-3207-44a4-9d73-c0ac840439e9
  #     description: Token for Vault access
  #     expires_ttl: 1h
  #     local: true
  #     meta: true
  #     node_identity:
  #       - server1:dc1
  #       - server2:dc1
  #     policy_id:
  #        - 24766e43-dec7-dfb3-3ba8-b0b71d343e54
  #        - a81019cb-822e-ae73-ed0d-3502403542d9
  #     policy_name:
  #       - node_policy
  #       - vault_policy
  #     role_id:
  #       - 12c27e6c-1c70-ec00-70dd-8f743fbe2d5d
  #     role_name:
  #       - vault_reader
  #     service_identity:
  #       - consul:dc1
  #       - vault:dc2
  #     format: pretty
  #     namespace: default

consul_kv: []
  # example:
  # consul_kv:
  #   - key: redis/config/connections
  #     value: 5
  #     acquire: true
  #     base64: true
  #     cas: true
  #     flags: 42
  #     modify_index: 123
  #     release: true
  #     session: abc123

consul_checks: []
  # example:
  # consul_checks:
  #   - id: ssh
  #     name: SSH TCP on port 22
  #     tcp: localhost:22
  #     interval: 10s
  #     timeout: 1s

consul_services: []
  # example:
  # consul_services:
  #   - id: red0
  #     name: redis
  #     tags:
  #       - primary
  #     address: ''
  #     port: 6000
  #     checks:
  #       - args:
  #           - /bin/check_redis
  #           - -p
  #           - '6000'
  #         interval: 5s
  #         timeout: 20s
  #   - id: red1
  #     name: redis
  #     tags:
  #       - delayed
  #       - secondary
  #     address: ''
  #     port: 7000
  #     checks:
  #       - args:
  #           - /bin/check_redis
  #           - -p
  #           - '7000'
  #         interval: 30s
  #         timeout: 60s

# Options for creating CA certificates
consul_tls_ca_create_options:
  - "-additional-name-constraint={{ groups[consul_servers_group_name] | map('extract', hostvars, 'inventory_hostname') | join(' -additional-name-constraint=') }}"
  - "-additional-name-constraint={{ groups[consul_servers_group_name] | map('extract', hostvars, 'ansible_host') | join(' -additional-name-constraint=') }}"
  - -domain={{ consul_domain }}
  - -name-constraint=true

# Options for creating server certificates
consul_tls_cert_create_options:
  - "-additional-dnsname={{ inventory_hostname }}"
  - "-additional-ipaddress={{ ansible_host }}"

consul_firewall_ports:
  - 8600/tcp
  - 8600/udp
  - 8500-8501/tcp
  - 8301-8302/tcp
  - 8301-8302/udp
  - 8300/tcp
  - 21000-21255/tcp
